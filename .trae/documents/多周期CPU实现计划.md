# 多周期CPU实现计划

## 设计思路

多周期CPU将指令执行分为5个阶段，每个阶段占用一个时钟周期：
1. **取指（IF）** - 从指令存储器读取指令
2. **译码（ID）** - 解析指令，读取寄存器堆
3. **执行（EX）** - 执行ALU运算或计算地址
4. **访存（MEM）** - 访问数据存储器
5. **写回（WB）** - 将结果写回寄存器堆

## 实现步骤

### 1. 实现控制单元（control_unit.v）

**功能**：根据指令和当前状态生成控制信号，管理状态转换

**主要组件**：
- 有限状态机（FSM）控制5个执行阶段
- 指令解析逻辑
- 控制信号生成逻辑

**状态定义**：
```verilog
localparam IF = 3'b000;
localparam ID = 3'b001;
localparam EX = 3'b010;
localparam MEM = 3'b011;
localparam WB = 3'b100;
```

**控制信号**：
- `reg_dst_flag`
- `alu_src_flag`
- `mem_to_reg_flag`
- `reg_write_flag`
- `mem_read_flag`
- `mem_write_flag`
- `branch_flag`
- `jump_flag`
- `alu_op`

### 2. 实现多周期CPU顶层模块（multi_period_cpu.v）

**功能**：实例化所有模块，连接信号，实现多周期执行

**主要组件**：
- 所有已实现模块的实例化
- 控制单元实例化
- 内部信号连接
- 状态机控制

**内部寄存器**：
- `pc_reg` - 保存当前PC值
- `inst_reg` - 保存当前指令
- `reg_data1_reg` - 保存寄存器堆读数据1
- `reg_data2_reg` - 保存寄存器堆读数据2
- `imm_reg` - 保存符号扩展后的立即数
- `alu_result_reg` - 保存ALU运算结果
- `mem_read_data_reg` - 保存数据存储器读数据

## 模块连接图

```
+----------------+     +----------------+     +----------------+
|  inst_memory   |     |  register_file |     |    data_mem    |
+----------------+     +----------------+     +----------------+
        |                       |                       |
        v                       v                       v
+--------------------------------------------------------------+
|                      multi_period_cpu                        |
+--------------------------------------------------------------+
|  +----------------+     +----------------+     +----------+  |
|  |      pc        |<--->|   control_unit |<--->|    alu   |  |
|  +----------------+     +----------------+     +----------+  |
|         |                     |                              |
|         v                     v                              |
|  +----------------+     +----------------+                   |
|  |   mux2 (32b)   |     | sign_extender  |                   |
|  +----------------+     +----------------+                   |
+--------------------------------------------------------------+
```

## 指令执行流程

| 指令类型 | IF | ID | EX | MEM | WB |
|---------|----|----|----|-----|----|
| R型指令 | ✔️ | ✔️ | ✔️ |     | ✔️ |
| I型指令 | ✔️ | ✔️ | ✔️ |     | ✔️ |
| beq     | ✔️ | ✔️ | ✔️ |     |    |
| j       | ✔️ | ✔️ |    |     |    |
| lw      | ✔️ | ✔️ | ✔️ | ✔️  | ✔️ |
| sw      | ✔️ | ✔️ | ✔️ | ✔️  |    |

## 实现时间线

1. 实现控制单元（control_unit.v） - 包含FSM和控制信号生成
2. 实现多周期CPU顶层模块（multi_period_cpu.v） - 实例化所有模块并连接信号
3. 测试多周期CPU功能 - 使用提供的测试指令验证正确性

## 预期结果

多周期CPU能够正确执行所有10条指令，寄存器堆和数据存储器的状态符合预期，与单周期CPU的执行结果一致，但执行时间更长（每个指令占用1-5个时钟周期）。