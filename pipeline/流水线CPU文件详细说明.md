# 流水线CPU项目文件详细说明

## 项目概述

这是一个基于Verilog HDL实现的5级流水线CPU设计，采用MIPS指令集架构。CPU包含完整的取指、译码、执行、访存和写回五个流水线阶段，并实现了数据前送、分支预测等优化技术。

## 顶层模块

### 1. pipelined_computer.v

**功能**: 整个流水线CPU的顶层模块
**作用**:

- 定义CPU与外部世界的接口（复位、时钟、输入输出端口）
- 实例化所有流水线阶段模块
- 连接各个模块之间的信号线
- 管理流水线寄存器之间的数据和控制信号传递
- 提供六位七段显示器输出用于结果显示

**关键信号**:

- `resetn`: 复位信号（低有效）
- `mem_clock`: 存储器时钟信号
- `in_port0, in_port1, in_port2`: 输入端口
- `HEX0-HEX5`: 七段显示器输出

## 流水线阶段模块

### 2. pipeif.v (取指阶段 - Instruction Fetch)

**功能**: 负责从指令存储器中取出指令
**主要组件**:

- `lpm_rom_irom`: 指令ROM存储器
- `mux4x32`: PC选择多路器
- PC递增逻辑

**主要功能**:

- 根据当前PC值从ROM中取出指令
- 计算下一条指令地址（PC+4）
- 根据控制信号选择下一条PC值（顺序、分支、跳转等）

### 3. pipeid.v (译码阶段 - Instruction Decode)

**功能**: 对取出的指令进行译码，生成控制信号
**主要组件**:

- `regfile`: 32个32位寄存器的寄存器文件
- `pipecu`: 流水线控制单元
- 符号扩展单元
- 分支地址计算单元

**主要功能**:

- 解析指令操作码和功能码
- 读取源操作数寄存器
- 生成ALU控制信号
- 检测数据相关性
- 处理分支指令
- 生成前送控制信号

### 4. pipeexe.v (执行阶段 - Execute)

**功能**: 执行算术逻辑运算
**主要组件**:

- `alu`: 算术逻辑单元
- `mux2x32`: 操作数选择器
- 移位器

**主要功能**:

- 执行算术逻辑运算
- 处理分支条件判断
- 计算跳转目标地址
- 处理立即数指令
- 执行移位指令

### 5. pipemem.v (访存阶段 - Memory Access)

**功能**: 访问数据存储器和I/O设备
**主要组件**:

- `lpm_ram_dq_dram`: 数据RAM存储器
- `io_input_reg`: I/O输入寄存器
- `io_output_reg`: I/O输出寄存器
- `mux2x32`: 数据选择器

**主要功能**:

- 访问数据存储器
- 处理I/O读写操作
- 根据地址最高位区分存储器访问和I/O访问
- 输出结果到外部设备

## 流水线寄存器模块

### 6. pipeir.v (指令寄存器)

**功能**: 暂存取出的指令和PC+4值
**作用**: 在取指和译码阶段之间传递指令信息

### 7. pipepc.v (程序计数器)

**功能**: 存储当前程序执行地址
**作用**: 控制指令的取址顺序，支持分支和跳转

### 8. pipedereg.v (IF/ID流水线寄存器)

**功能**: 在取指和译码阶段之间传递数据
**传递的数据**:

- PC+4值
- 指令内容
- 控制信号

### 9. pipeemreg.v (ID/EXE流水线寄存器)

**功能**: 在译码和执行阶段之间传递数据
**传递的数据**:

- 寄存器操作数
- 立即数
- ALU控制信号
- 目标寄存器号

### 10. pipemwreg.v (EXE/MEM流水线寄存器)

**功能**: 在执行和访存阶段之间传递数据
**传递的数据**:

- ALU计算结果
- 寄存器写回控制信号
- 存储器访问控制信号

## 控制单元

### 11. pipecu.v (流水线控制单元)

**功能**: 生成各阶段所需的控制信号
**主要功能**:

- 指令译码
- 生成ALU控制信号
- 生成存储器访问控制信号
- 生成寄存器写回控制信号
- 处理分支和跳转指令
- 生成流水线停顿信号

## 功能单元

### 12. alu.v (算术逻辑单元)

**功能**: 执行各种算术和逻辑运算
**支持的运算**:

- 算术运算: ADD, SUB
- 逻辑运算: AND, OR, XOR
- 移位运算: SLL, SRL, SRA
- 特殊运算: LUI (高位加载)
- 零标志位生成

### 13. regfile.v (寄存器文件)

**功能**: 实现32个32位寄存器的读写
**特点**:

- 读操作异步进行
- 写操作在时钟上升沿进行
- 寄存器0恒为0
- 支持同时读写

## 存储器模块

### 14. lpm_rom_irom.v (指令ROM)

**功能**: 存储程序指令
**特点**:

- 只读存储器
- 按字寻址
- 异步读操作
- Altera IP核生成

### 15. lpm_ram_dq_dram.v (数据RAM)

**功能**: 存储程序数据
**特点**:

- 读写存储器
- 同步读操作
- 支持写使能控制
- Altera IP核生成

## I/O接口模块

### 16. io_input_mux.v (I/O输入选择器)

**功能**: 选择不同的输入数据源

### 17. io_input_reg.v (I/O输入寄存器)

**功能**: 暂存外部输入数据
**接口**:

- 支持多个输入端口
- 同步输入数据
- 提供数据给CPU读取

### 18. io_output_reg.v (I/O输出寄存器)

**功能**: 暂存CPU输出数据
**接口**:

- 支持多个输出端口
- 同步输出数据
- 显示到外部设备

## 复用器和选择器

### 19. mux2x32.v (2选1多路选择器，32位)

**功能**: 在两个32位数据中选择一个
**应用**: 立即数选择、数据前送选择等

### 20. mux4x32.v (4选1多路选择器，32位)

**功能**: 在四个32位数据中选择一个
**应用**: PC值选择、下一条指令地址选择等

### 21. mux2x5.v (2选1多路选择器，5位)

**功能**: 在两个5位数据中选择一个
**应用**: 目标寄存器号选择

## 触发器和寄存器

### 22. dff32.v (32位D触发器)

**功能**: 基本的32位数据存储
**特点**: 异步复位，同步装载

### 23. dffe32.v (32位使能D触发器)

**功能**: 带使能控制的32位数据存储
**特点**: 只有在使能信号有效时才更新数据

## 显示驱动模块

### 24. sevenseg.v (七段显示器驱动)

**功能**: 将4位二进制数转换为七段显示码
**特点**:

- 支持0-F的十六进制显示
- 共阴极显示
- 低电平有效

## 文档和资源

### 25. README.md

**功能**: 项目说明文档
**内容**: 项目介绍、使用方法、技术说明等

### 26. Screenshots/ (截图目录)

**功能**: 包含项目运行的截图
**文件**:

- 1.png, 2.png, 3.png, 4.png: 不同阶段的运行截图

## 流水线CPU工作流程

1. **取指阶段(IF)**: 从指令ROM中取出指令，更新PC
2. **译码阶段(ID)**: 解析指令，读取寄存器，生成控制信号
3. **执行阶段(EXE)**: 执行ALU运算，处理分支跳转
4. **访存阶段(MEM)**: 访问数据存储器，处理I/O操作
5. **写回阶段(WB)**: 将结果写回寄存器文件

## 主要技术特点

- **5级流水线**: IF→ID→EXE→MEM→WB
- **数据前送**: 解决数据相关性问题
- **分支预测**: 减少分支延迟
- **I/O接口**: 支持外部设备交互
- **模块化设计**: 便于维护和扩展
- **完整的控制逻辑**: 支持MIPS指令集的主要指令

这个流水线CPU设计展示了现代处理器的基本架构和工作原理，是学习计算机组成原理和处理器设计的优秀案例。
